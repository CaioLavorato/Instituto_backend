{% extends 'baseLogado.html' %}
{% block content %}
{% load static %}
<style>
.form-section {
    margin: 20px 0;
}

.form-row {
    display: flex;
    justify-content: space-between; /* Distribui as colunas igualmente */
}

.form-col {
    flex: 1; /* Permite que as colunas ocupem espaço igual */
    margin-right: 15px; /* Espaçamento entre colunas */
}

.form-col:last-child {
    margin-right: 0; /* Remove a margem da última coluna */
}

.checkbox-group {
    display: flex;
    align-items: center; /* Alinha checkbox e label verticalmente */
    margin-bottom: 10px; /* Espaçamento entre checkboxes */
}

.checkbox-group input[type="checkbox"] {
    margin-right: 10px; /* Espaçamento entre checkbox e label */
    transform: scale(1.2); /* Aumenta o tamanho do checkbox para melhor visibilidade */
}



/* Alinhamento adicional para manter consistência */
.checkbox-group label {
    display: flex;
    align-items: center; /* Alinha o texto do label ao centro */
}

    .img-round {
        border-radius: 50%;
        width: 100px;
        height: 100px;
        object-fit: cover;
    }

    .alert {
        position: relative;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid transparent;
        border-radius: 4px;
        color: #721c24;
        background-color: #f8d7da;
    }

    .alert.success {
        color: #155724;
        background-color: #d4edda;
    }

    .alert .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 1.25rem;
        color: inherit;
        cursor: pointer;
    }


</style>
<!-- INNER PAGE WRAPPER ============================================= -->
<div class="inner-page-wrapper">

    <!-- BREADCRUMB ============================================= -->
    <div id="breadcrumb" class="division">
        <div class="container">
            <div class="row">
                <!-- BREADCRUMB NAV -->
                <div class="col-md-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'homepage' %}">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Perfil</li>
                        </ol>
                    </nav>
                </div>
            </div> <!-- End row -->
        </div> <!-- End container -->
    </div> <!-- END BREADCRUMB -->

    <!-- PAGE HERO ============================================= -->
    <section class="bg-05 page-hero-section division">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="hero-txt white-color">
                        <div class="row align-items-center">
                            <!-- Imagem do Usuário -->
                            <div class="col-auto">
                                <img src="{% if user.profile.foto %}{{ user.profile.foto.url }}{% else %}{% static 'images/post-author-1.jpg' %}{% endif %}" alt="author-avatar" class="img-round">
                            </div>
                            <!-- Título -->
                            <div class="col">
                                <h3 class="h3-xs">{{ user.first_name }} {{ user.last_name }}</h3>
                            </div>
                        </div> <!-- End row -->
                    </div>
                </div> <!-- END PAGE HERO TEXT -->
            </div> <!-- End row -->
        </div> <!-- End container -->
    </section> <!-- END PAGE HERO -->

    <!-- PROFILE FORM SECTION ============================================= -->
    <section class="wide-70 form-section division">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <div class="form-holder card p-4 shadow-sm">
                        <!-- Title -->
                        <h4 class="h4-sm mb-4">Atualizar Perfil - {{ user.first_name }} {{ user.last_name }}</h4>
                         <!-- Mensagens -->
                     {% if messages %}
                         {% for message in messages %}
                             {% if message.tags == 'success' %}
                                 <div class="alert success">
                             {% else %}
                                 <div class="alert">
                             {% endif %}
                                 <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                                 <p>{{ message }}</p>
                             </div>
                         {% endfor %}
                     {% endif %}
                        <!-- Abas do Formulário -->
                        <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <a class="nav-link active" id="dados-gerais-tab" data-bs-toggle="tab" href="#dados-gerais" role="tab" aria-controls="dados-gerais" aria-selected="true">Dados Gerais</a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="seguranca-tab" data-bs-toggle="tab" href="#seguranca" role="tab" aria-controls="seguranca" aria-selected="false">Segurança</a>
                            </li>
                            <li class="nav-item" role="presentation" id="redes-sociais-tab-item" style="display: none;">
                                <a class="nav-link" id="redes-sociais-tab" data-bs-toggle="tab" href="#redes-sociais" role="tab" aria-controls="redes-sociais" aria-selected="false">Redes Sociais e Descrição</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="profileTabsContent">
                            <div class="tab-pane fade show active" id="dados-gerais" role="tabpanel" aria-labelledby="dados-gerais-tab">
                                <form method="post" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    
                                    <!-- Primeira seção -->
                                    <div class="form-section mt-5">
                                        <div class="form-row">
                                            <div class="form-col required">
                                                <label for="id_cpf">CPF</label>
                                                {{ form.cpf }}
                                            </div>
                                            <div class="form-col required">
                                                <label for="id_data_de_nascimento">Data Nascimento</label>
                                                <input type="date" name="data_de_nascimento" value="{{ form.data_de_nascimento.value|date:'Y-m-d' }}" class="form-control" id="id_data_de_nascimento">
                                            </div>
                                            <div class="form-col">
                                                <label for="id_foto">Foto</label>
                                                {{ form.foto }}
                                            </div>
                                        </div>
                                    </div>
                        
                                    <!-- Segunda seção -->
                                    <div class="form-section">
                                        <div class="form-row">
                                            <div class="form-col required">
                                                <label for="id_sexo">Sexo</label>
                                                {{ form.sexo }}
                                            </div>
                                            <div class="form-col required">
                                                <label for="id_auto_declaracao_raca">Auto Declaração de Raça</label>
                                                {{ form.auto_declaracao_raca }}
                                            </div>
                                            <div class="form-col required">
                                                <label for="id_grau_de_escolaridade">Grau de Escolaridade</label>
                                                {{ form.grau_de_escolaridade }}
                                            </div>
                                        </div>
                                    </div>
                        
                                    <!-- Terceira seção -->
                                    <div class="form-section">
                                        <div class="form-row">
                                            <div class="form-col required">
                                                <label for="id_categoria_profissional">Categoria Profissional</label>
                                                {{ form.categoria_profissional }}
                                            </div>
                                            <div class="form-col">
                                                <label for="id_especialidade">Especialidade</label>
                                                {{ form.especialidade }}
                                            </div>

                                        </div>
                                    </div>
                        
                                    <div class="form-section">
                                        <!-- Seção de opções com radio buttons -->
                                        <div class="form-row">
                                            <div class="form-col">
                                                <label>Já Participou de Capacitação</label>
                                                <div class="radio-group">
                                                    <input type="radio" id="id_ja_participou_capacitacao_sim" name="ja_participou_capacitacao" value="true"
                                                           {% if form.ja_participou_capacitacao.value %}checked{% endif %}>
                                                    <label for="id_ja_participou_capacitacao_sim">Sim</label>
                                                    <input type="radio" id="id_ja_participou_capacitacao_nao" name="ja_participou_capacitacao" value="false"
                                                           {% if not form.ja_participou_capacitacao.value %}checked{% endif %}>
                                                    <label for="id_ja_participou_capacitacao_nao">Não</label>
                                                </div>
                                            </div>
                                
                                            <div class="form-col">
                                                <label>Aceito os Termos</label>
                                                <div class="radio-group">
                                                    <input type="radio" id="id_aceito_termos_sim" name="aceito_termos" value="true"
                                                           {% if form.aceito_termos.value  %}checked{% endif %}>
                                                    <label for="id_aceito_termos_sim">Sim</label>
                                                    <input type="radio" id="id_aceito_termos_nao" name="aceito_termos" value="false"
                                                           {% if not form.aceito_termos.value %}checked{% endif %}>
                                                    <label for="id_aceito_termos_nao">Não</label>
                                                </div>
                                            </div>
                                
                                            <div class="form-col required">
                                                <label>Vinculado à Instituição</label>
                                                <div class="radio-group">
                                                    <input type="radio" id="id_vinculado_instituicao_sim" name="vinculado_instituicao" value="true"
                                                           {% if form.vinculado_instituicao.value  %}checked{% endif %}>
                                                    <label for="id_vinculado_instituicao_sim">Sim</label>
                                                    <input type="radio" id="id_vinculado_instituicao_nao" name="vinculado_instituicao" value="false"
                                                           {% if not form.vinculado_instituicao.value  %}checked{% endif %}>
                                                    <label for="id_vinculado_instituicao_nao">Não</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                  
                                    <button type="submit" class="btn btn-blue tra-black-hover last-link">Salvar</button>
                                </form>
                            </div>
                            <div class="tab-pane fade" id="seguranca" role="tabpanel" aria-labelledby="seguranca-tab">
                                <form method="post" class="p-4">
                                    {% csrf_token %}
                                    <input type="hidden" name="change_password" value="1">  <!-- Campo oculto -->
                                    
                                    <!-- Título do formulário -->
                                    <h4 class="mb-4">Alterar Senha</h4>
                                
                                    <div class="form-section">
                                        <div class="form-row">
                                            <div class="form-col col-6 required">
                                                <label for="{{ password_form.old_password.id_for_label }}" class="form-label">Senha Atual</label>
                                                <input type="password" name="{{ password_form.old_password.name }}" 
                                                       class="form-control" 
                                                       id="{{ password_form.old_password.id_for_label }}" 
                                                       required>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row">
                                            <div class="form-col col-6 required">
                                                <label for="{{ password_form.new_password1.id_for_label }}" class="form-label">Nova Senha</label>
                                                <input type="password" name="{{ password_form.new_password1.name }}" 
                                                       class="form-control" 
                                                       id="{{ password_form.new_password1.id_for_label }}" 
                                                       required>
                                            </div>
                                        </div>
                                        
                                        <div class="form-row">
                                            <div class="form-col col-6 required">
                                                <label for="{{ password_form.new_password2.id_for_label }}" class="form-label">Confirme a Nova Senha</label>
                                                <input type="password" name="{{ password_form.new_password2.name }}" 
                                                       class="form-control" 
                                                       id="{{ password_form.new_password2.id_for_label }}" 
                                                       required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Botão de envio -->
                                    <button type="submit" class="btn btn-blue tra-black-hover last-link">Alterar Senha</button>
                                </form>
                            </div>
                            
                            <div class="tab-pane fade" id="redes-sociais" role="tabpanel" aria-labelledby="redes-sociais-tab">
                                <!-- Redes Sociais e Descrição Form -->
                                <form method="post" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="id_facebook">Facebook</label>
                                        {{ form.facebook }}
                                        <label for="id_linkedin">LinkedIn</label>
                                        {{ form.linkedin }}
                                        <label for="id_google_plus">Google+</label>
                                        {{ form.google_plus }}
                                        <label for="id_descricao">Descrição</label>
                                        {{ form.descricao }}
                                        <label for="id_web_site">Website</label>
                                        {{ form.web_site }}
                                        <label for="id_categorias">Categorias</label>
                                        {{ form.categorias }}
                                    </div>
                                    <button type="submit" class="btn btn-blue tra-black-hover last-link">Salvar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- End row -->
        </div> <!-- End container -->
    </section> <!-- END PROFILE FORM SECTION -->

</div> <!-- END INNER PAGE WRAPPER -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
<script>

    var cpf = document.querySelector("#id_cpf");

    cpf.addEventListener("blur", function(){
        if(cpf.value) cpf.value = cpf.value.match(/.{1,3}/g).join(".").replace(/\.(?=[^.]*$)/,"-");
    });      


    const redesSociaisTab = document.getElementById('redes-sociais-tab-item');
    const tipoUsuario = '{{ user.profile.tipo }}'; // Obtém o tipo do usuário diretamente do contexto

    function toggleRedesSociaisTab() {
        if (tipoUsuario === 'PR') {  // Verifica se o tipo é 'Professor'
            redesSociaisTab.style.display = 'block';
        } else {
            redesSociaisTab.style.display = 'none';
        }
    }

    // Executa a função para definir a aba correta ao carregar a página
    toggleRedesSociaisTab();
</script>

{% endblock %}
